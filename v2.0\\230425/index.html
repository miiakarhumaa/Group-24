<!DOCTYPE html>
<html>
    <head>
        <title>:)</title>
        <meta http-equiv="refresh" content="2">
        <style>
            body { font-family: sans-serif; padding: 15px; }
            h1, h2 { color: #333; }
            p { font-size: 1.1em; }
            strong { color: #007bff; }
            #status-message {
                margin-top: 15px;
                padding: 10px;
                background-color: #e7f3fe;
                border-left: 6px solid #2196F3;
                font-weight: bold;
                min-height: 1.2em
                }
        </style>
    </head>
    <body>
        <h1>Pico W Sensor Data</h1>

        <p id="dhtTemp">Fridge temperature: <strong>{dht_temp} &deg;C</strong></p>
        <p>Fridge humidity: <strong>{dht_humidity} %</strong></p>
        
        <p id="ntcTemp">Drink temperature: <strong>{ntc_temp} &deg;C</strong></p>

        <div id="status-message">{cool_message}</div>
        <script>
            const NTC_TRESHOLD = 5.0;

            var dhtTemp;
            var ntcTemp;
            var dhtText;
            var ntcText;
            var dhtLen;
            var ntcLen;
            
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            function sendNotification() {
                const notification = new Notification("Your drink is ready to enjoy!");
            }
            
            if (Notification.permission !== "granted")
                Notification.requestPermission();
            
            while (true) {
                sleep(5000);
                dhtTemp = document.getElementById("dhtTemp").innerText.match(/[0-9.]+/);
                ntcTemp = document.getElementById("ntcTemp").innerText.match(/[0-9.]+/);
                dhtTemp = parseFloat(dhtTemp);
                ntcTemp = parseFloat(ntcTemp);
            
                if (ntcTemp <= NTC_TRESHOLD) {
                    sendNotification();
                    sleep(15000);
                }
            }
        </script>
    </body>
</html>
